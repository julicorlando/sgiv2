<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo - Retirada de Produtos - Almoxarifado</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <style>
        .navbar-carpina {
            background-color: #5bc0eb !important;
        }
        .navbar-carpina .navbar-brand,
        .navbar-carpina .nav-link,
        .navbar-carpina .navbar-text {
            color: #fff !important;
            font-weight: 500;
        }
        .scanner-container {
            width: 100%;
            max-width: 400px;
            height: 300px;
            margin: 20px auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            display: none;
        }
        .btn-scanner {
            background-color: #28a745;
            border-color: #28a745;
        }
        .btn-scanner:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }
        .produto-info {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }
        .produto-encontrado {
            display: block;
            border-color: #28a745;
            background-color: #d4edda;
        }
        .estoque-baixo {
            color: #dc3545;
            font-weight: bold;
        }
        .estoque-normal {
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-carpina mb-4">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="#">
            <span>SGI v2</span>
        </a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a href="#" class="nav-link">üè† In√≠cio</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        üè™ Almoxarifado
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">üì¶ Gest√£o de Produtos</a></li>
                        <li><a class="dropdown-item" href="#">üìä Relat√≥rios e Auditoria</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" style="font-weight: bold;">üì§ Retirada de Produtos</a></li>
                    </ul>
                </li>
            </ul>
            <span class="navbar-text me-3">
                üëã Bem-vindo(a) Funcion√°rio Demo
            </span>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h2>üì¶ Retirada de Produtos - Almoxarifado</h2>
            <p class="text-muted">Registre a retirada de produtos do estoque</p>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">üõí Registrar Retirada</h5>
                </div>
                <div class="card-body">
                    <form id="formRetirada">
                        <div class="mb-3">
                            <label for="codigo_barras" class="form-label">C√≥digo de Barras do Produto *</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="codigo_barras" placeholder="Escaneie ou digite o c√≥digo" required autocomplete="off">
                                <button type="button" class="btn btn-scanner" id="btnScanner">
                                    üì∑ Escanear
                                </button>
                            </div>
                            <div class="form-text">Digite ou escaneie o c√≥digo de barras do produto</div>
                        </div>
                        
                        <div id="scanner-container" class="scanner-container">
                            <div id="scanner-controls" class="text-center p-2">
                                <button type="button" class="btn btn-sm btn-secondary" id="btnStopScanner">Parar Scanner</button>
                            </div>
                        </div>
                        
                        <div id="produto-info" class="produto-info">
                            <h6>üìã Informa√ß√µes do Produto</h6>
                            <div id="produto-detalhes"></div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="quantidade" class="form-label">Quantidade a Retirar *</label>
                            <input type="number" class="form-control" id="quantidade" placeholder="1" required min="1" max="9999">
                            <div class="form-text">Quantidade de produtos a serem retirados</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="observacao" class="form-label">Observa√ß√£o</label>
                            <textarea class="form-control" id="observacao" rows="3" placeholder="Informa√ß√µes adicionais sobre a retirada (opcional)"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <div class="bg-light p-3 rounded">
                                <small><strong>Respons√°vel pela retirada:</strong> Funcion√°rio Demo</small><br>
                                <small><strong>Data/Hora:</strong> 19/09/2025 12:00</small>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-primary" id="btnRetirar" onclick="registrarRetiradaDemo()">
                            üì§ Registrar Retirada
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">üìã Minhas √öltimas Retiradas</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-sm" id="tabelaRetiradas">
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Produto</th>
                                    <th>Qtd</th>
                                    <th>Observa√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><small>18/09/2025 14:30</small></td>
                                    <td>
                                        <strong>Papel A4 500 folhas</strong><br>
                                        <small class="text-muted">7898324567123</small>
                                    </td>
                                    <td><span class="badge bg-info">10</span></td>
                                    <td><small>Para escrit√≥rio</small></td>
                                </tr>
                                <tr>
                                    <td><small>17/09/2025 09:15</small></td>
                                    <td>
                                        <strong>Caneta Azul BIC</strong><br>
                                        <small class="text-muted">7891234567890</small>
                                    </td>
                                    <td><span class="badge bg-info">5</span></td>
                                    <td><small>-</small></td>
                                </tr>
                                <tr>
                                    <td><small>16/09/2025 16:45</small></td>
                                    <td>
                                        <strong>Marca Texto Amarelo</strong><br>
                                        <small class="text-muted">7898765432100</small>
                                    </td>
                                    <td><span class="badge bg-info">2</span></td>
                                    <td><small>Para apresenta√ß√£o</small></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Produtos demo em estoque
const produtosDemo = {
    '7898324567123': {
        id: 1,
        nome_produto: 'Papel A4 500 folhas',
        codigo_barras: '7898324567123',
        quantidade_atual: 140,
        ativo: true
    },
    '7891234567890': {
        id: 2,
        nome_produto: 'Caneta Azul BIC',
        codigo_barras: '7891234567890',
        quantidade_atual: 3,
        ativo: true
    },
    '7898765432100': {
        id: 3,
        nome_produto: 'Marca Texto Amarelo',
        codigo_barras: '7898765432100',
        quantidade_atual: 48,
        ativo: true
    }
};

let produtoAtual = null;

function buscarProduto(codigo) {
    const produtoInfo = document.getElementById('produto-info');
    const produtoDetalhes = document.getElementById('produto-detalhes');
    const quantidadeInput = document.getElementById('quantidade');
    const btnRetirar = document.getElementById('btnRetirar');
    
    if (!codigo.trim()) {
        produtoInfo.classList.remove('produto-encontrado');
        produtoInfo.style.display = 'none';
        btnRetirar.disabled = false;
        return;
    }
    
    const produto = produtosDemo[codigo];
    
    if (produto) {
        produtoAtual = produto;
        
        const estoqueClass = produto.quantidade_atual > 10 ? 'estoque-normal' : 'estoque-baixo';
        
        produtoDetalhes.innerHTML = `
            <div class="row">
                <div class="col-12">
                    <strong>${produto.nome_produto}</strong><br>
                    <small class="text-muted">C√≥digo: ${produto.codigo_barras}</small>
                </div>
                <div class="col-6">
                    <small><strong>Estoque atual:</strong></small><br>
                    <span class="${estoqueClass}">${produto.quantidade_atual} unidades</span>
                </div>
                <div class="col-6">
                    <small><strong>Status:</strong></small><br>
                    <span class="badge ${produto.ativo ? 'bg-success' : 'bg-secondary'}">
                        ${produto.ativo ? 'Ativo' : 'Inativo'}
                    </span>
                </div>
            </div>
        `;
        
        produtoInfo.classList.add('produto-encontrado');
        produtoInfo.style.display = 'block';
        
        quantidadeInput.max = produto.quantidade_atual;
        
        if (!produto.ativo || produto.quantidade_atual <= 0) {
            btnRetirar.disabled = true;
            if (!produto.ativo) {
                produtoDetalhes.innerHTML += '<div class="alert alert-warning mt-2 mb-0">Produto inativo - n√£o pode ser retirado</div>';
            } else {
                produtoDetalhes.innerHTML += '<div class="alert alert-danger mt-2 mb-0">Produto sem estoque</div>';
            }
        } else {
            btnRetirar.disabled = false;
        }
        
    } else {
        produtoInfo.classList.remove('produto-encontrado');
        produtoInfo.style.display = 'none';
        btnRetirar.disabled = false;
        produtoAtual = null;
    }
}

function registrarRetiradaDemo() {
    const codigo = document.getElementById('codigo_barras').value;
    const quantidade = parseInt(document.getElementById('quantidade').value);
    const observacao = document.getElementById('observacao').value;
    
    if (!codigo || !quantidade || quantidade <= 0) {
        alert('Por favor, preencha o c√≥digo de barras e uma quantidade v√°lida.');
        return;
    }
    
    if (!produtoAtual) {
        alert('Produto n√£o encontrado com este c√≥digo.');
        return;
    }
    
    if (quantidade > produtoAtual.quantidade_atual) {
        alert(`Quantidade insuficiente em estoque. Dispon√≠vel: ${produtoAtual.quantidade_atual}`);
        return;
    }
    
    // Simular retirada
    produtosDemo[codigo].quantidade_atual -= quantidade;
    
    // Adicionar √† tabela de retiradas
    const tbody = document.querySelector('#tabelaRetiradas tbody');
    const novaLinha = document.createElement('tr');
    novaLinha.innerHTML = `
        <td><small>${new Date().toLocaleDateString('pt-BR')} ${new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}</small></td>
        <td>
            <strong>${produtoAtual.nome_produto}</strong><br>
            <small class="text-muted">${codigo}</small>
        </td>
        <td><span class="badge bg-info">${quantidade}</span></td>
        <td><small>${observacao || '-'}</small></td>
    `;
    tbody.insertBefore(novaLinha, tbody.firstChild);
    
    // Limpar campos
    document.getElementById('codigo_barras').value = '';
    document.getElementById('quantidade').value = '';
    document.getElementById('observacao').value = '';
    document.getElementById('produto-info').style.display = 'none';
    produtoAtual = null;
    
    alert(`Retirada registrada com sucesso!\nProduto: ${produtoAtual ? produtoAtual.nome_produto : 'Produto'}\nQuantidade: ${quantidade}\n(Demonstra√ß√£o)`);
}

// Scanner simulation e eventos
document.addEventListener('DOMContentLoaded', function() {
    const btnScanner = document.getElementById('btnScanner');
    const btnStopScanner = document.getElementById('btnStopScanner');
    const scannerContainer = document.getElementById('scanner-container');
    const codigoBarrasInput = document.getElementById('codigo_barras');
    const quantidadeInput = document.getElementById('quantidade');
    
    let scannerActive = false;
    
    // Buscar produto quando o c√≥digo mudar
    codigoBarrasInput.addEventListener('input', function() {
        buscarProduto(this.value);
    });
    
    // Validar quantidade
    quantidadeInput.addEventListener('input', function() {
        if (produtoAtual && parseInt(this.value) > produtoAtual.quantidade_atual) {
            this.value = produtoAtual.quantidade_atual;
        }
    });
    
    // Scanner
    btnScanner.addEventListener('click', function() {
        if (scannerActive) return;
        
        scannerContainer.style.display = 'block';
        scannerActive = true;
        btnScanner.textContent = 'üì∑ Scanner Ativo';
        btnScanner.disabled = true;
        
        // Simular detec√ß√£o ap√≥s 2 segundos
        setTimeout(function() {
            const codigoSimulado = '7891234567890'; // Caneta com estoque baixo
            codigoBarrasInput.value = codigoSimulado;
            buscarProduto(codigoSimulado);
            
            scannerContainer.style.display = 'none';
            scannerActive = false;
            btnScanner.textContent = 'üì∑ Escanear';
            btnScanner.disabled = false;
            
            quantidadeInput.focus();
            alert('C√≥digo simulado detectado: ' + codigoSimulado);
        }, 2000);
    });
    
    btnStopScanner.addEventListener('click', function() {
        if (scannerActive) {
            scannerContainer.style.display = 'none';
            scannerActive = false;
            btnScanner.textContent = 'üì∑ Escanear';
            btnScanner.disabled = false;
        }
    });
});
</script>

</body>
</html>